<%= render "shared/DOM-listeners" %>

function refreshForm(innerHTML, hide) {
  const editShareForm = document.querySelector('#edit_share_<%=@share.id%>');
  editShareForm.innerHTML = innerHTML;
  const closeEditFormBtn = editShareForm.querySelector(".close-form-btn")
  if (closeEditFormBtn) {
    addCloseBtnListener(closeEditFormBtn);
  }
}

function updateShare(shareHTML) {
  let share = document.querySelector("[data-share-id = '<%=@share.id%>']");
  const editShareForm = document.querySelector('#edit_share_<%=@share.id%>');
  share.insertAdjacentHTML("beforebegin", shareHTML);
  share.remove();
  editShareForm.remove();
  share = document.querySelector("[data-share-id = '<%=@share.id%>']");
  const editButton = share.querySelector(".edit-share-info");
  if (editButton) {
    addEditButtonListener(editButton);
  }
}

<% if @share.errors.any? %>
  refreshForm('<%= j render "shared/share-form", share: @share, form_class:"edit-share-form" %>', false);
<% else %>
  updateShare('<%= j render "shared/share-row", share: @share %>');
<% end %>
