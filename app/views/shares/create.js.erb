<%= render "shared/DOM-listeners" %>

function refreshForm(innerHTML, hide) {
  const newShareForm = document.querySelector('#new_share');
  const addOwnerBtn = document.querySelector(".show-new-share-form");
  newShareForm.innerHTML = innerHTML;
  const closeBtn = newShareForm.querySelector(".close-form-btn")
  if (closeBtn) {
    addCloseBtnListener(closeBtn);
  }

  if (hide) {
    newShareForm.classList.toggle("hidden")
    addOwnerBtn.classList.toggle("hidden");
  }
}

function addShare(shareHTML) {
  const shares = document.getElementById('shares-table');
  shares.insertAdjacentHTML('afterend', shareHTML);
  const shareRow = document.querySelector("[data-share-id = '<%= @share.id %>']")
  const editButton = shareRow.querySelector(".edit-share-info");
  if (editButton) {
    addEditButtonListener(editButton);
  }
  const editForm = document.getElementById("edit_share_<%= @share.id %>");
  const closeEditFormBtn =  editForm.querySelector(".close-form-btn");
  if (closeEditFormBtn) {
    addCloseBtnListener(closeEditFormBtn);
  }

}

<% if @share.errors.any? %>
  refreshForm('<%= j render "shared/share-form", share: @share, form_class:"new-share-form" %>', false);
<% else %>
  addShare('<%= j render "shared/share-row", share: @share %>');
  refreshForm('<%= j render "shared/share-form", share: Share.new, form_class:"new-share-form" %>', true);
  <% if @property %>
    togglePaymentAlert('<%= j percentage(@property.payment_sum) %>');
  <% end %>
<% end %>

