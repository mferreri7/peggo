function toggleEditFormHiddenClases(editButton) {
  const dataRow = editButton.parentNode.parentNode;
  const form = dataRow.previousElementSibling;
  form.classList.toggle("hidden");
  dataRow.classList.toggle("hidden");
}

function toggleNewFormHiddenClases(addButton) {
  const form = document.querySelector("#new_share")
  form.classList.toggle("hidden");
  addButton.classList.toggle("hidden");
}

function closeForm(closeBtn) {
  const form = closeBtn.parentNode.parentNode;
  const dataRow = form.nextElementSibling;
  const addButton = document.querySelector(".show-new-share-form");
  form.classList.toggle("hidden");

  if (dataRow){
    dataRow.classList.toggle("hidden");
  }

  if(addButton.classList.contains("hidden")) {
    addButton.classList.remove("hidden")
  }
}

function addClickListeners(elements, callback) {
  for (let i = 0; i < elements.length; i++) {
    elements[i].addEventListener("click", (event) => {
      event.preventDefault();
      callback(event.currentTarget);
    })
  }
}

function init() {
  const editButtons = document.querySelectorAll(".edit-share-info");
  const showFormButtons = document.querySelectorAll(".show-new-share-form");
  const closeFormBtns = document.querySelectorAll(".close-form-btn");
  if (editButtons) {
    addClickListeners(editButtons, toggleEditFormHiddenClases);
  }

  if (showFormButtons){
    addClickListeners(showFormButtons, toggleNewFormHiddenClases);
  }

  if (closeFormBtns) {
    addClickListeners(closeFormBtns, closeForm);
  }
}
function refreshForm(innerHTML, hide) {
  const newShareForm = document.querySelector('#new_share');
  const addOwnerBtn = document.querySelector(".show-new-share-form");
  newShareForm.innerHTML = innerHTML;
  if (hide) {
    newShareForm.classList.toggle("hidden")
    addOwnerBtn.classList.toggle("hidden");
  }
}

function addShare(shareHTML) {
  const shares = document.getElementById('shares-table');
  shares.insertAdjacentHTML('afterend', shareHTML);
}

<% if @share.errors.any? %>
  refreshForm('<%= j render "shared/share-form", share: @share, form_class:"" %>', false);
  init();
<% else %>
  addShare('<%= j render "shared/share-row", share: @share %>');
  refreshForm('<%= j render "shared/share-form", share: Share.new, form_class:"" %>', true);
  init();
<% end %>
